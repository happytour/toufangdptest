<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="format-detection" content="telephone=no">
    <title>测试工具</title>
</head>

<body>
    <h1>测试工具</h1>
    <p>测试工具v7</p>
    <!--下面按钮放到一列-->
    <!--下面按钮高度变高-->
    <!--按钮之间间距变大-->
    <style>
        button {
            height: 50px;
            font-size: 16px;
        }
    </style>
    <div style="display: flex; flex-direction: column; gap: 10px;">
        <button id="mainAction">mainAction</button>
        <button id="carveRecords">carveRecords</button>
        <button id="showSharedMenu">showSharedMenu</button>
    </div>
    <script>
        // 存储回调函数
        const pendingCallbacks = {};
        let callbackId = 0;
        // 定义call函数
        function call(api, data, success, error, timeout) {
            const id = 'callback_' + (callbackId++);
            // 存储回调
            pendingCallbacks[id] = {
                success: success,
                error: error
            };
            // 发送到父页面
            window.parent.postMessage({
                type: 'iframe',
                callbackId: id,
                api: api,
                data: data,
                timeout: timeout
            }, '*');
        }
        // 监听父页面返回的消息
        window.addEventListener('message', function (event) {
            if (event.data && event.data.type === 'iframe') {
                const { callbackId, success, data } = event.data;
                const callback = pendingCallbacks[callbackId];
                if (callback) {
                    if (success) {
                        callback.success(data);
                    } else {
                        callback.error(data);
                    }
                    // 删除已处理的回调
                    delete pendingCallbacks[data.callbackId];
                }
            }
        });
        document.getElementById('mainAction').addEventListener('click', function () {
            call(
                'MtopWVPlugin.send',
                { "api": "mtop.tmall.farm.gaia.base.new.extra.set.security", "data": { "bizCode": "Bargaining", "params": "{\"action\":\"mainAction\",\"hdFrom\":\"farm_main_kkj\"}", "asac": "2A247225H5RHA0R0BPN6HG" }, "v": "1.0", "type": "originaljson", "ecode": 0, "timeout": 5000, "needLogin": false, "isSec": 1, "secType": 2, "key": "bargain.mainAction", "preventFallback": true, "param": { "bizCode": "Bargaining", "params": "{\"action\":\"mainAction\",\"hdFrom\":\"farm_main_kkj\"}", "asac": "2A247225H5RHA0R0BPN6HG" }, "sessionOption": "AutoLoginOnly" },
                function (result) {
                    alert('Success: ' + JSON.stringify(result));
                },
                function (error) {
                    alert('Error: ' + JSON.stringify(error));
                },
                5000
            );
        });
        document.getElementById('carveRecords').addEventListener('click', function () {
            call(
                'MtopWVPlugin.send',
                { "api": "mtop.tmall.farm.gaia.base.new.extra.set", "data": { "bizCode": "Bargaining", "params": "{\"action\":\"carveRecords\",\"pageNum\":1,\"pageSize\":20}" }, "v": "1.0", "type": "originaljson", "ecode": 0, "timeout": 5000, "needLogin": false, "preventFallback": true, "param": { "bizCode": "Bargaining", "params": "{\"action\":\"carveRecords\",\"pageNum\":1,\"pageSize\":20}" }, "sessionOption": "AutoLoginOnly" },
                function (result) {
                    alert('Success: ' + JSON.stringify(result));
                },
                function (error) {
                    alert('Error: ' + JSON.stringify(error));
                },
                5000
            );
        });
        document.getElementById('showSharedMenu').addEventListener('click', function () {
            call(
                'Base.copyToClipboard',
                {
                    "text": "测试测试5"
                },
                function (result) {
                    call(
                        'WVUIDialog.alert',
                        {
                            "title": "复制成功",
                            "message": "前往微信找到好友粘贴",
                            "okbutton": "前往"
                        },
                        function (result) {
                            call(
                                'TBSharedModule.openApp',
                                { "packageName": "com.tencent.mm" },
                                function (result) {
                                    alert('Success: ' + JSON.stringify(result));
                                },
                                function (error) {
                                    alert('Error: ' + JSON.stringify(error));
                                },
                                5000
                            );
                        },
                        function (error) {
                            alert('Error: ' + JSON.stringify(error));
                        },
                        5000
                    );
                },
                function (error) {
                    alert('Error: ' + JSON.stringify(error));
                },
                5000
            );
        });
    </script>
</body>

</html>
